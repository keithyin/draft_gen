
#include "../UnanimityInternalConfig.h"

#include <cassert>
#include <cmath>
#include <memory>
#include <random>
#include <stdexcept>

#include <pacbio/consensus/ModelConfig.h>
#include <pacbio/data/Read.h>
#include <pacbio/data/internal/BaseEncoding.h>

#include "../ModelFactory.h"
#include "../Recursor.h"
#include "../Simulator.h"
#include "CounterWeight.h"
#include "HelperFunctions.h"

using namespace PacBio::Data;

namespace PacBio {
namespace Consensus {
namespace Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2 {
namespace {

static constexpr const size_t CONTEXT_NUMBER = 16;
static constexpr const size_t OUTCOME_NUMBER = 64; // 4cr, 4pw, 4base

class Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model : public ModelConfig
{
public:
    static std::set<std::string> Chemistries() { return {"Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2"}; }
    static ModelForm Form() { return ModelForm::PWSNR; }
    Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model(const NucleotideLevelFeats& feats);
    std::unique_ptr<AbstractRecursor> CreateRecursor(const MappedRead& mr,
                                                     double scoreDiff) const override;
    std::vector<TemplatePosition> Populate(const std::string& tpl) const override;
    std::pair<Data::Read, std::vector<MoveType>> SimulateRead(
        std::default_random_engine* const rng, const std::string& tpl,
        const std::string& readname) const override;

    double ExpectedLLForEmission(MoveType move, const AlleleRep& prev, const AlleleRep& curr,
                                 MomentType moment) const override;

private:
    double ctxTrans_[CONTEXT_NUMBER][4];
    double cachedEmissionExpectations_[CONTEXT_NUMBER][3][2];
};

// TODO(lhepler) comments regarding the CRTP
class Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor : public Recursor<Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor>
{
public:
    Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor(const MappedRead& mr, double scoreDiff, double counterWeight);
    static inline std::vector<uint8_t> EncodeRead(const MappedRead& read);
    inline double EmissionPr(MoveType move, uint8_t emission, const AlleleRep& prev,
                             const AlleleRep& curr) const;
    double UndoCounterWeights(size_t nEmissions) const override;

private:
    double counterWeight_;
    double nLgCounterWeight_;
};

static constexpr const double snrRanges[2][4] = {
    {3.91070819, 7.37540293, 3.84641552, 6.27542830},  // minimum
    {8.06702614, 15.2471046, 7.02776623, 11.3469543}   // maximum
};

// match branch stick
static constexpr const double emissionPmf[3][CONTEXT_NUMBER][OUTCOME_NUMBER] = {
{
 {0.3556911,0.004587964,0.0031475276,0.0048295213,0.40092042,0.0024528713,0.0016151577,0.0033466262,0.21817414,0.002753858,0.0006866504,0.0017302391,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741,0.0000012293741},
{0.005852018,0.2425179,0.0032401618,0.0023917675,0.0060117035,0.35200495,0.0019198976,0.0012240399,0.005675588,0.37714997,0.0010856482,0.0008448391,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194,0.0000015674194},
{0.007127469,0.0038301095,0.47712222,0.0049426565,0.007373181,0.002592696,0.37119222,0.0014688993,0.0060803704,0.0035346055,0.1136898,0.00096340344,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902,0.0000015849902},
{0.0067004887,0.0027722467,0.002834918,0.45756957,0.0066811275,0.0019708863,0.0018017425,0.37335965,0.0069535,0.0037550689,0.0014919242,0.13403906,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904,0.0000013431904},
{0.27688336,0.0054777404,0.003213803,0.003521458,0.36595666,0.0052321036,0.0012186851,0.0026243315,0.3237597,0.00919847,0.0005374199,0.0023096467,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846,0.0000012809846},
{0.0035527556,0.17037705,0.0032911634,0.002473821,0.0023820964,0.2727996,0.0019094315,0.001565465,0.0019367711,0.53707564,0.0013142184,0.0012462073,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356,0.0000014576356},
{0.0037066892,0.005769407,0.37541595,0.003591777,0.0014312242,0.005543907,0.36390972,0.0015654169,0.00116686,0.008542696,0.22824723,0.0010504053,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905,0.0000011292905},
{0.0045045465,0.0037679034,0.0027854072,0.31774127,0.0031378376,0.0036847428,0.0020321093,0.35676122,0.0027338378,0.007121302,0.0022456455,0.29340273,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876,0.0000015661876},
{0.30136985,0.003487917,0.0056124283,0.0036590109,0.35888508,0.0015657558,0.004399032,0.002762522,0.310513,0.0021608907,0.0032233135,0.002282093,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894,0.0000015219894},
{0.0022091696,0.16598266,0.004232724,0.0027750842,0.0016433954,0.26690662,0.0032933764,0.001067825,0.0018021759,0.546524,0.002623522,0.00088952214,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855,0.0000009608855},
{0.0038471573,0.0040976102,0.36223802,0.005473214,0.0024108263,0.0030494737,0.36069715,0.0026236603,0.0021093686,0.0048459577,0.2463166,0.0022136637,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358,0.0000014873358},
{0.003598172,0.0020121012,0.003909588,0.30986118,0.0029950668,0.0014701827,0.0034208267,0.35392973,0.0037954368,0.003440862,0.003448274,0.30803633,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751,0.000001582751},
{0.1502807,0.002555855,0.0020821218,0.0049378485,0.28905246,0.0016053532,0.0010330223,0.0052423677,0.5341092,0.0019241475,0.00085124036,0.0062245973,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456,0.0000019444456},
{0.0019185104,0.10582055,0.0018907151,0.0028874413,0.0014174558,0.2070156,0.001396451,0.0027197194,0.0014606618,0.6691294,0.0016881963,0.0025803559,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419,0.0000014425419},
{0.0017681908,0.0021194355,0.19850816,0.0034870543,0.0010417671,0.0015575452,0.32857576,0.002738006,0.0011041629,0.002815852,0.45375413,0.0024664828,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053,0.00000122053},
{0.0034683703,0.0020028027,0.0019978937,0.22660814,0.003550691,0.0016472893,0.0016329397,0.33378696,0.004677883,0.0040165856,0.002519298,0.41402924,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515,0.0000011909515} 
},
{
 {0.38692388,0.00014778129,0.00014778129,0.00014778129,0.35292697,0.00014778129,0.00014778129,0.00014778129,0.25113449,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129,0.00014778129},
{0.18378572,0.16924302,0.000017881255,0.000017881255,0.20607622,0.13022089,0.000017881255,0.000017881255,0.19432868,0.11530836,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255,0.000017881255},
{0.2614564,0.000025619747,0.12751698,0.000025619747,0.27970767,0.000025619747,0.0732981,0.000025619747,0.22766209,0.000025619747,0.02887283,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747,0.000025619747},
{0.22722787,0.000021333068,0.000021333068,0.14065984,0.24167295,0.000021333068,0.000021333068,0.096514955,0.24291392,0.000021333068,0.000021333068,0.049773168,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068,0.000021333068},
{0.17738214,0.14882791,0.000013423878,0.000013423878,0.18183723,0.11838387,0.000013423878,0.000013423878,0.1825523,0.19023795,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878,0.000013423878},
{0.00021779895,0.3229321,0.00021779895,0.00021779895,0.00021779895,0.26924732,0.00021779895,0.00021779895,0.00021779895,0.39453483,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895,0.00021779895},
{0.000020170792,0.2200963,0.14417738,0.000020170792,0.000020170792,0.18870318,0.099228494,0.000020170792,0.000020170792,0.28426847,0.062356282,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792,0.000020170792},
{0.000023516335,0.20367554,0.000023516335,0.13216868,0.000023516335,0.16774546,0.000023516335,0.12150087,0.000023516335,0.26268435,0.000023516335,0.11086116,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335,0.000023516335},
{0.24375257,0.000025773634,0.14031543,0.000025773634,0.23312189,0.000025773634,0.091999926,0.000025773634,0.21485026,0.000025773634,0.07446506,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634,0.000025773634},
{0.000016993888,0.25872326,0.15106407,0.000016993888,0.000016993888,0.18954818,0.09915644,0.000016993888,0.000016993888,0.22684437,0.07367804,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888,0.000016993888},
{0.00030149275,0.00030149275,0.4594529,0.00030149275,0.00030149275,0.00030149275,0.31031692,0.00030149275,0.00030149275,0.00030149275,0.21183911,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275,0.00030149275},
{0.0000406017,0.0000406017,0.15975481,0.21809845,0.0000406017,0.0000406017,0.12156247,0.20663986,0.0000406017,0.0000406017,0.098033294,0.19355622,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017,0.0000406017},
{0.16696523,0.000020345093,0.000020345093,0.08382575,0.20774622,0.000020345093,0.000020345093,0.08343621,0.37246606,0.000020345093,0.000020345093,0.08438053,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093,0.000020345093},
{0.000017486522,0.21687211,0.000017486522,0.09343816,0.000017486522,0.1772596,0.000017486522,0.08666448,0.000017486522,0.3380392,0.000017486522,0.08671225,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522,0.000017486522},
{0.000029337789,0.000029337789,0.18433076,0.18922946,0.000029337789,0.000029337789,0.15860939,0.14478843,0.000029337789,0.000029337789,0.1860581,0.13528226,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789,0.000029337789},
{0.00026154966,0.00026154966,0.00026154966,0.32435346,0.00026154966,0.00026154966,0.00026154966,0.32313502,0.00026154966,0.00026154966,0.00026154966,0.33655697,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966,0.00026154966} 
},
{
 {0.000037035865,0.3118185,0.19180334,0.121590555,0.000037035865,0.086238466,0.06437737,0.063877836,0.000037035865,0.09040636,0.030451613,0.037398998,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865,0.000037035865},
{0.00007619897,0.00007619897,0.32704413,0.29596797,0.00007619897,0.00007619897,0.11165565,0.12444779,0.00007619897,0.00007619897,0.054274112,0.08219081,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897,0.00007619897},
{0.000052328956,0.19740397,0.000052328956,0.4959177,0.000052328956,0.100998715,0.000052328956,0.05778138,0.000052328956,0.10944665,0.000052328956,0.035416495,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956,0.000052328956},
{0.000084488354,0.29541454,0.24279273,0.000084488354,0.000084488354,0.13547604,0.09473823,0.000084488354,0.000084488354,0.16433603,0.0623421,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354,0.000084488354},
{0.00008197623,0.00008197623,0.5265213,0.18702576,0.00008197623,0.00008197623,0.0917414,0.08435754,0.00008197623,0.00008197623,0.046124622,0.05947475,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623,0.00008197623},
{0.25043786,0.000060240254,0.24607116,0.14810288,0.084293745,0.000060240254,0.074700855,0.051030844,0.06093963,0.000060240254,0.044467594,0.03664224,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254,0.000060240254},
{0.42146915,0.00004826113,0.00004826113,0.38232112,0.06646146,0.00004826113,0.00004826113,0.04958301,0.045578517,0.00004826113,0.00004826113,0.031787604,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113,0.00004826113},
{0.40499008,0.00008966296,0.24774311,0.00008966296,0.103624135,0.00008966296,0.08755041,0.00008966296,0.07732665,0.00008966296,0.07356518,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296,0.00008966296},
{0.00007174354,0.49028838,0.00007174354,0.16255687,0.00007174354,0.11148772,0.00007174354,0.06821411,0.00007174354,0.11977497,0.00007174354,0.043516833,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354,0.00007174354},
{0.23450202,0.000045294757,0.000045294757,0.46378297,0.08299436,0.000045294757,0.000045294757,0.11075563,0.053983618,0.000045294757,0.000045294757,0.051354315,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757,0.000045294757},
{0.16843927,0.14609598,0.000040215753,0.35101682,0.05288862,0.07517992,0.000040215753,0.04318485,0.038767986,0.093040615,0.000040215753,0.029174076,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753,0.000040215753},
{0.34315372,0.2759215,0.000083609484,0.000083609484,0.08645017,0.095331125,0.000083609484,0.000083609484,0.07734489,0.116949275,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484,0.000083609484},
{0.00010414312,0.31890655,0.30097106,0.00010414312,0.00010414312,0.11704925,0.0788465,0.00010414312,0.00010414312,0.12899776,0.049188573,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312,0.00010414312},
{0.2908927,0.00007632096,0.3185283,0.00007632096,0.12253237,0.00007632096,0.09625562,0.00007632096,0.101825185,0.00007632096,0.065539226,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096,0.00007632096},
{0.28299558,0.28615284,0.00007627964,0.00007627964,0.09087137,0.12171067,0.00007627964,0.00007627964,0.069968894,0.14387642,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964,0.00007627964},
{0.21279335,0.167629,0.14257163,0.000051086652,0.08963464,0.075026356,0.059370164,0.000051086652,0.092475556,0.10200758,0.05568196,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652,0.000051086652} 
}

};

static constexpr const double transProbs[CONTEXT_NUMBER][4] = {
 {0.8907869,0.007391296,0.02970394,0.072117805}, // AA
{0.8613659,0.07635706,0.017851397,0.044425573}, // AC
{0.8583136,0.05350888,0.026152572,0.062024865}, // AG
{0.85947776,0.054356083,0.013669205,0.07249694}, // AT
{0.83133346,0.07926903,0.012923566,0.07647389}, // CA
{0.9265115,0.006114884,0.02233448,0.045039073}, // CC
{0.8737953,0.048861045,0.020384768,0.056958888}, // CG
{0.8822909,0.058678005,0.015324513,0.04370657}, // CT
{0.85214615,0.05024298,0.017996434,0.07961439}, // GA
{0.8938131,0.05048701,0.018907595,0.03679236}, // GC
{0.90120816,0.0043605044,0.033247583,0.061183732}, // GG
{0.90381455,0.035144854,0.017019635,0.044020902}, // GT
{0.8248871,0.07874425,0.015300634,0.08106803}, // TA
{0.8797194,0.072497495,0.016547881,0.031235281}, // TC
{0.9105649,0.037813745,0.014499709,0.037121605}, // TG
{0.9375602,0.0041979854,0.02178696,0.03645485}, // TT
    };

inline double CalculateExpectedLLForEmission(const size_t move, const uint8_t row,
                                             const size_t moment)
{
    double expectedLL = 0;
    for (size_t i = 0; i < OUTCOME_NUMBER; i++) {
        double curProb = emissionPmf[move][row][i];
        double lgCurProb = std::log(curProb);
        if (!std::isfinite(lgCurProb)) continue;
        if (moment == static_cast<uint8_t>(MomentType::FIRST))
            expectedLL += curProb * lgCurProb;
        else if (moment == static_cast<uint8_t>(MomentType::SECOND))
            expectedLL += curProb * (lgCurProb * lgCurProb);
    }
    return expectedLL;
}

Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model::Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model(const NucleotideLevelFeats& feats){
    for (size_t ctx = 0; ctx < CONTEXT_NUMBER; ++ctx) {
        const uint8_t bp = ctx & 3;  // (equivalent to % 4)
        double sum = 0.0;

        // cached transitions
        for (size_t j = 0; j < 4; ++j) {
            double xb = transProbs[ctx][j];
            ctxTrans_[ctx][j] = xb;
            sum += xb;
        }
        for (size_t j = 0; j < 4; ++j)
            ctxTrans_[ctx][j] /= sum;

        // cached expectations
        for (size_t move = 0; move < 3; ++move)
            for (size_t moment = 0; moment < 2; ++moment)
                cachedEmissionExpectations_[ctx][move][moment] =
                    CalculateExpectedLLForEmission(move, ctx, moment);
    }
}

std::unique_ptr<AbstractRecursor> Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model::CreateRecursor(const MappedRead& mr,
                                                                 double scoreDiff) const
{
    const double counterWeight = CounterWeight(
        [this](size_t ctx, MoveType m) { return ctxTrans_[ctx][static_cast<uint8_t>(m)]; },
        [](size_t ctx, MoveType m) {
            double r = 0.0;
            for (size_t o = 0; o < OUTCOME_NUMBER; ++o) {
                const double p = emissionPmf[static_cast<uint8_t>(m)][ctx][o];
                if (p > 0.0) r += p * std::log(p);
            }
            return r;
        },
        CONTEXT_NUMBER);

    return std::make_unique<Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor>(mr, scoreDiff, counterWeight);
}

std::vector<TemplatePosition> Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model::Populate(const std::string& tpl) const
{
    auto rowFetcher = [this](const NCBI2na prev, const NCBI2na curr) -> const double(&)[4]
    {
        const auto row = EncodeContext16(prev, curr);
        const double(&params)[4] = ctxTrans_[row];
        return params;
    };
    return AbstractPopulater(tpl, rowFetcher);
}

double Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model::ExpectedLLForEmission(const MoveType move, const AlleleRep& prev,
                                             const AlleleRep& curr, const MomentType moment) const
{
    auto cachedEmissionVisitor = [this](const MoveType move, const NCBI2na prev, const NCBI2na curr,
                                        const MomentType moment) -> double {
        const auto row = EncodeContext16(prev, curr);
        return cachedEmissionExpectations_[row][static_cast<uint8_t>(move)]
                                          [static_cast<uint8_t>(moment)];
    };
    return AbstractExpectedLLForEmission(move, prev, curr, moment, cachedEmissionVisitor);
}

Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor::Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor(const MappedRead& mr, double scoreDiff, double counterWeight)
    : Recursor<Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor>(mr, scoreDiff)
    , counterWeight_{counterWeight}
    , nLgCounterWeight_{-std::log(counterWeight_)}
{
}

std::vector<uint8_t> Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor::EncodeRead(const MappedRead& read)
{
    std::vector<uint8_t> result;
    result.reserve(read.Length());
    std::vector<uint8_t> pw_boundaries = {18, 46};
    std::vector<uint8_t> cr_boundaries = {255};
    for (size_t i = 0; i < read.Length(); ++i) {
        result.emplace_back(EncodeBaseV3(read.Seq[i], read.PulseWidth[i], pw_boundaries, read.CR[i], cr_boundaries));
    }

    return result;
}

double Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor::EmissionPr(const MoveType move, const uint8_t emission,
                                     const AlleleRep& prev, const AlleleRep& curr) const
{
    return AbstractEmissionPrV2(emissionPmf, move, emission, prev, curr) * counterWeight_;
}

double Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Recursor::UndoCounterWeights(const size_t nEmissions) const
{
    return nLgCounterWeight_ * nEmissions;
}

inline std::pair<Data::SNR, std::vector<TemplatePosition>> Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_InitialiseModel(
    std::default_random_engine* const rng, const std::string& tpl)
{
    Data::SNR snrs{0, 0, 0, 0};
    for (uint8_t i = 0; i < 4; ++i) {
        snrs[i] = std::uniform_real_distribution<double>{snrRanges[0][i], snrRanges[1][i]}(*rng);
    }


    Data::NucleotideLevelFeats feats;

    const Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model model{feats};
    std::vector<TemplatePosition> transModel = model.Populate(tpl);

    return {snrs, transModel};
}

BaseData Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_GenerateReadData(std::default_random_engine* const rng, const MoveType state,
                                   const AlleleRep& prev, const AlleleRep& curr)
{
    // distribution is arbitrary at the moment, as
    // IPD is not a covariate of the consensus HMM
    std::uniform_int_distribution<uint8_t> ipdDistrib(1, 5);

    std::array<double, OUTCOME_NUMBER> emissionDist;
    for (size_t i = 0; i < OUTCOME_NUMBER; ++i) {
        emissionDist[i] = AbstractEmissionPrV2(emissionPmf, state, i, prev, curr);
    }

    std::discrete_distribution<uint8_t> outcomeDistrib(emissionDist.cbegin(), emissionDist.cend());

    const uint8_t event = outcomeDistrib(*rng);
    const std::pair<char, uint8_t> outcome = DecodeEmission(event);

    return {outcome.first, outcome.second, ipdDistrib(*rng)};
}

std::pair<Data::Read, std::vector<MoveType>> Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_Model::SimulateRead(
    std::default_random_engine* const rng, const std::string& tpl,
    const std::string& readname) const
{
    return SimulateReadImpl(rng, tpl, readname, Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_InitialiseModel,
                            Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2_GenerateReadData);
}

}  // namespace anonymous
}  // namespace S_P2C2v5

REGISTER_MODEL_IMPL(Kit__500_Chem__1_BC__1_PW3_v3_sig_0_0_2)

}  // namespace Consensus
}  // namespace PacBio
