// Author: Lance Hepler

#include "../UnanimityInternalConfig.h"

#include <cassert>
#include <cmath>
#include <memory>
#include <random>
#include <stdexcept>

#include <pacbio/consensus/ModelConfig.h>
#include <pacbio/data/Read.h>
#include <pacbio/data/internal/BaseEncoding.h>

#include "../ModelFactory.h"
#include "../Recursor.h"
#include "../Simulator.h"
#include "CounterWeight.h"
#include "HelperFunctions.h"

using namespace PacBio::Data;

namespace PacBio {
namespace Consensus {
namespace Kit__500_Chem__1_BC__1_PW3_v6 {
namespace {

static constexpr const size_t CONTEXT_NUMBER = 16;
static constexpr const size_t OUTCOME_NUMBER = 64; // 4cr, 4pw, 4base

class Kit__500_Chem__1_BC__1_PW3_v6_Model : public ModelConfig
{
public:
    static std::set<std::string> Chemistries() { return {"Kit__500_Chem__1_BC__1_PW3_v6"}; }
    static ModelForm Form() { return ModelForm::PWSNR; }
    Kit__500_Chem__1_BC__1_PW3_v6_Model(const NucleotideLevelFeats& feats);
    std::unique_ptr<AbstractRecursor> CreateRecursor(const MappedRead& mr,
                                                     double scoreDiff) const override;
    std::vector<TemplatePosition> Populate(const std::string& tpl) const override;
    std::pair<Data::Read, std::vector<MoveType>> SimulateRead(
        std::default_random_engine* const rng, const std::string& tpl,
        const std::string& readname) const override;

    double ExpectedLLForEmission(MoveType move, const AlleleRep& prev, const AlleleRep& curr,
                                 MomentType moment) const override;

private:
    double ctxTrans_[CONTEXT_NUMBER][4];
    double cachedEmissionExpectations_[CONTEXT_NUMBER][3][2];
};

// TODO(lhepler) comments regarding the CRTP
class Kit__500_Chem__1_BC__1_PW3_v6_Recursor : public Recursor<Kit__500_Chem__1_BC__1_PW3_v6_Recursor>
{
public:
    Kit__500_Chem__1_BC__1_PW3_v6_Recursor(const MappedRead& mr, double scoreDiff, double counterWeight);
    static inline std::vector<uint8_t> EncodeRead(const MappedRead& read);
    inline double EmissionPr(MoveType move, uint8_t emission, const AlleleRep& prev,
                             const AlleleRep& curr) const;
    double UndoCounterWeights(size_t nEmissions) const override;

private:
    double counterWeight_;
    double nLgCounterWeight_;
};

static constexpr const double snrRanges[2][4] = {
    {3.91070819, 7.37540293, 3.84641552, 6.27542830},  // minimum
    {8.06702614, 15.2471046, 7.02776623, 11.3469543}   // maximum
};

static constexpr const double emissionPmf[3][CONTEXT_NUMBER][OUTCOME_NUMBER] = {
	{
		// match
  {0.37080032,0.0031896094,0.00446364,0.0041257455,0.4175035,0.0012213432,0.004371303,0.0027009412,0.18691896,0.0011982534,0.002337861,0.0011684294,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531,0.000000001713531},
{0.0046044514,0.24070384,0.0013481916,0.0014380208,0.005054904,0.37911198,0.0005736058,0.00091412384,0.0040567885,0.36122647,0.0003611741,0.00060630345,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757,0.000000003024757},
{0.005813267,0.0017746108,0.46042368,0.003640294,0.0063286847,0.0011244621,0.39641306,0.0009732995,0.00472223,0.0011608049,0.11694267,0.0006828337,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577,0.0000000021772577},
{0.0052000345,0.001077907,0.0019117965,0.45331573,0.005768237,0.0008107727,0.001526514,0.39072686,0.0050342884,0.0012053234,0.0011659359,0.13225652,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817,0.0000000020302817},
{0.30423692,0.0032569969,0.0041162455,0.0026084932,0.3924302,0.0038307335,0.0037599006,0.0018970888,0.2735389,0.0061051594,0.0028728175,0.0013464701,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122,0.0000000021497122},
{0.0034282804,0.17400478,0.0014567005,0.0017469069,0.0023098688,0.3018335,0.00041716214,0.0013384896,0.0014816519,0.5108082,0.00025267637,0.00092154817,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443,0.0000000029835443},
{0.0038681892,0.002835475,0.37855515,0.0021691213,0.0010930961,0.0036808678,0.38935867,0.00096169085,0.00071709143,0.0057960367,0.21044853,0.0005152962,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775,0.000000015835775},
{0.0017767542,0.0016704007,0.0015880798,0.34224832,0.0012439715,0.0023732595,0.0012760272,0.38552243,0.0010926736,0.0043743923,0.0011180091,0.25571552,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438,0.0000000021463438},
{0.3054548,0.0022217473,0.0067174234,0.002650094,0.38685519,0.000724665,0.0069240336,0.001775669,0.27981928,0.0007650757,0.004797992,0.0012938903,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935,0.0000000026052935},
{0.0013686309,0.13854061,0.0022176884,0.0020174035,0.000992022,0.27014062,0.0019110847,0.00075120927,0.00086814567,0.579348,0.0013419517,0.0005024419,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385,0.0000000034630385},
{0.0034054313,0.0018390586,0.3537417,0.0041637793,0.0021591843,0.0013959397,0.39123064,0.0015257974,0.0014586789,0.0020782202,0.23604287,0.0009584765,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457,0.0000000030604457},
{0.0017458764,0.0008106909,0.0026876724,0.30110854,0.0014652655,0.00076414883,0.0028945687,0.3795615,0.0015333748,0.0015299789,0.0025268926,0.30337134,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849,0.00000000301849},
{0.15811066,0.0010931513,0.002038075,0.0041026655,0.32014635,0.0005454088,0.0028052453,0.0044865254,0.49668396,0.0006494864,0.0050415727,0.004296766,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948,0.000000002395948},
{0.0009111297,0.095642015,0.00053096947,0.0017534228,0.0006884546,0.22334556,0.00023277929,0.001932519,0.0005792239,0.6723893,0.00021517609,0.0017793407,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227,0.0000000025097227},
{0.0010791488,0.00070460263,0.20053656,0.0026536013,0.00075265195,0.00063850294,0.3589602,0.002258761,0.00069830567,0.0011976128,0.42865875,0.0018611647,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474,0.000000002075474},
{0.001549158,0.0007328358,0.0011374772,0.23592351,0.0015943173,0.0008184153,0.0012406379,0.3627687,0.0022011292,0.0019699775,0.0016463962,0.3884173,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547,0.0000000016163547} 

		},

{ // branch
  
{0.37626725,0.00000021277909,0.00000021277909,0.00000021277909,0.40031,0.00000021277909,0.00000021277909,0.00000021277909,0.22340974,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909,0.00000021277909},
{0.30789402,0.011342314,0.00000003625677,0.00000003625677,0.3723617,0.008288733,0.00000003625677,0.00000003625677,0.29298785,0.007123295,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677,0.00000003625677},
{0.31854546,0.000000025516515,0.014874292,0.000000025516515,0.37158406,0.000000025516515,0.010090429,0.000000025516515,0.27999625,0.000000025516515,0.0049080253,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515,0.000000025516515},
{0.31894258,0.00000002379928,0.00000002379928,0.009197875,0.36965024,0.00000002379928,0.00000002379928,0.007566101,0.29077694,0.00000002379928,0.00000002379928,0.0038648841,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928,0.00000002379928},
{0.03223406,0.24505752,0.00000004425288,0.00000004425288,0.03158558,0.24825072,0.00000004425288,0.00000004425288,0.021404587,0.42146498,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288,0.00000004425288},
{0.000000884937,0.3056926,0.000000884937,0.000000884937,0.000000884937,0.29669812,0.000000884937,0.000000884937,0.000000884937,0.39755526,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937,0.000000884937},
{0.0000003564568,0.21987681,0.028262034,0.0000003564568,0.0000003564568,0.26800704,0.020227855,0.0000003564568,0.0000003564568,0.4518518,0.011753807,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568,0.0000003564568},
{0.000000049524573,0.20252787,0.000000049524573,0.02069117,0.000000049524573,0.25556895,0.000000049524573,0.018967317,0.000000049524573,0.48927316,0.000000049524573,0.012968654,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573,0.000000049524573},
{0.045518503,0.00000008707226,0.38993675,0.00000008707226,0.046582874,0.00000008707226,0.27424356,0.00000008707226,0.032788802,0.00000008707226,0.21092445,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226,0.00000008707226},
{0.00000013344477,0.040215984,0.37124977,0.00000013344477,0.00000013344477,0.028168323,0.29234174,0.00000013344477,0.00000013344477,0.03419589,0.23382059,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477,0.00000013344477},
{0.0000008527883,0.0000008527883,0.43353453,0.0000008527883,0.0000008527883,0.0000008527883,0.34968755,0.0000008527883,0.0000008527883,0.0000008527883,0.2167259,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883,0.0000008527883},
{0.00000013107045,0.00000013107045,0.3018256,0.027395297,0.00000013107045,0.00000013107045,0.3302426,0.026404666,0.00000013107045,0.00000013107045,0.29365468,0.020469533,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045,0.00000013107045},
{0.0407795,0.00000006245597,0.00000006245597,0.27429712,0.05236477,0.00000006245597,0.00000006245597,0.3080329,0.0591488,0.00000006245597,0.00000006245597,0.2653733,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597,0.00000006245597},
{0.000000074895375,0.021824587,0.000000074895375,0.28005457,0.000000074895375,0.025816811,0.000000074895375,0.30790448,0.000000074895375,0.056064807,0.000000074895375,0.30833042,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375,0.000000074895375},
{0.00000005823538,0.00000005823538,0.025633292,0.36710167,0.00000005823538,0.00000005823538,0.026953138,0.29736987,0.00000005823538,0.00000005823538,0.026882675,0.256056,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538,0.00000005823538},
{0.00000045271238,0.00000045271238,0.00000045271238,0.2962346,0.00000045271238,0.00000045271238,0.00000045271238,0.35876596,0.00000045271238,0.00000045271238,0.00000045271238,0.3449718,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238,0.00000045271238} 

	},


    {// stickPmf

 {0.00000006753348,0.34839872,0.21152458,0.12616733,0.00000006753348,0.047674447,0.08502134,0.06357777,0.00000006753348,0.038360905,0.04602116,0.03325004,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348,0.00000006753348},
{0.00000026596368,0.00000026596368,0.29345208,0.35256383,0.00000026596368,0.00000026596368,0.11012864,0.11633251,0.00000026596368,0.00000026596368,0.06758935,0.059918158,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368,0.00000026596368},
{0.000000112217315,0.12310834,0.000000112217315,0.69397646,0.000000112217315,0.048280824,0.000000112217315,0.060633034,0.000000112217315,0.039792147,0.000000112217315,0.034202714,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315,0.000000112217315},
{0.0000003122163,0.22197266,0.27240184,0.0000003122163,0.0000003122163,0.094983995,0.1723262,0.0000003122163,0.0000003122163,0.096009314,0.14228788,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163,0.0000003122163},
{0.00000016496914,0.00000016496914,0.59047306,0.16506086,0.00000016496914,0.00000016496914,0.08795428,0.06936094,0.00000016496914,0.00000016496914,0.04759772,0.039543595,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914,0.00000016496914},
{0.2643279,0.00000022192401,0.2556316,0.18565784,0.08026548,0.00000022192401,0.04142145,0.062356874,0.048390973,0.00000022192401,0.021767193,0.040168468,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401,0.00000022192401},
{0.7163358,0.00000066468016,0.00000066468016,0.1774902,0.036389243,0.00000066468016,0.00000066468016,0.031336345,0.021069031,0.00000066468016,0.00000066468016,0.01734084,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016,0.00000066468016},
{0.48900545,0.00000020340724,0.256359,0.00000020340724,0.073764615,0.00000020340724,0.070443995,0.00000020340724,0.055227913,0.00000020340724,0.05518723,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724,0.00000020340724},
{0.00000019546566,0.61656636,0.00000019546566,0.18577154,0.00000019546566,0.056476288,0.00000019546566,0.062706366,0.00000019546566,0.042773556,0.00000019546566,0.035694573,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566,0.00000019546566},
{0.18759106,0.00000020220546,0.00000020220546,0.56681746,0.060638383,0.00000020220546,0.00000020220546,0.11752565,0.031865355,0.00000020220546,0.00000020220546,0.03555035,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546,0.00000020220546},
{0.24237585,0.0740596,0.00000012076183,0.4679175,0.059334148,0.028595554,0.00000012076183,0.037179425,0.038850285,0.029873816,0.00000012076183,0.02180717,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183,0.00000012076183},
{0.47604463,0.23870279,0.0000003212058,0.0000003212058,0.092605874,0.057431914,0.0000003212058,0.0000003212058,0.07236156,0.0628346,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058,0.0000003212058},
{0.00000021262852,0.29247245,0.36165327,0.00000021262852,0.00000021262852,0.07119887,0.11943131,0.00000021262852,0.00000021262852,0.061024386,0.094207406,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852,0.00000021262852},
{0.26194146,0.00000032136785,0.39674917,0.00000032136785,0.1221471,0.00000032136785,0.08847353,0.00000032136785,0.08165668,0.00000032136785,0.049013417,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785,0.00000032136785},
{0.42484224,0.18390459,0.00000025526705,0.00000025526705,0.12787297,0.08230576,0.00000025526705,0.00000025526705,0.08795482,0.09310483,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705,0.00000025526705},
{0.27192774,0.10878311,0.11986611,0.0000001426879,0.115071505,0.051848784,0.07354676,0.0000001426879,0.11183149,0.07471709,0.07239955,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879,0.0000001426879} 

}};

static constexpr const double transProbs[CONTEXT_NUMBER][4] = {
{0.87605876,0.0070548924,0.022228198,0.09465818}, // AA
{0.89675933,0.074812874,0.01019851,0.018229334}, // AC
{0.87568194,0.07471954,0.016989997,0.032608524}, // AG
{0.8876924,0.07572763,0.0057723764,0.030807558}, // AT
{0.8987986,0.04366164,0.01171212,0.045827642}, // CA
{0.92377806,0.0031143203,0.01241909,0.060688533}, // CC
{0.90814376,0.040343873,0.021635314,0.029877007}, // CG
{0.9260554,0.04013416,0.009771569,0.02403887}, // CT
{0.9186158,0.027485803,0.012243758,0.04165459}, // GA
{0.94687444,0.024572229,0.016216284,0.012337014}, // GC
{0.8922783,0.0032019916,0.022612683,0.081907}, // GG
{0.9488481,0.02185134,0.008916496,0.020384042}, // GT
{0.91950256,0.035274,0.010361031,0.03486242}, // TA
{0.9511819,0.031873684,0.007428105,0.009516342}, // TC
{0.9422776,0.033582088,0.007661157,0.016479125}, // TG
{0.93887603,0.0033520462,0.010635401,0.047136527}, // TT
    };

inline double CalculateExpectedLLForEmission(const size_t move, const uint8_t row,
                                             const size_t moment)
{
    double expectedLL = 0;
    for (size_t i = 0; i < OUTCOME_NUMBER; i++) {
        double curProb = emissionPmf[move][row][i];
        double lgCurProb = std::log(curProb);
        if (!std::isfinite(lgCurProb)) continue;
        if (moment == static_cast<uint8_t>(MomentType::FIRST))
            expectedLL += curProb * lgCurProb;
        else if (moment == static_cast<uint8_t>(MomentType::SECOND))
            expectedLL += curProb * (lgCurProb * lgCurProb);
    }
    return expectedLL;
}

Kit__500_Chem__1_BC__1_PW3_v6_Model::Kit__500_Chem__1_BC__1_PW3_v6_Model(const NucleotideLevelFeats& feats){
    for (size_t ctx = 0; ctx < CONTEXT_NUMBER; ++ctx) {
        const uint8_t bp = ctx & 3;  // (equivalent to % 4)
        double sum = 0.0;

        // cached transitions
        for (size_t j = 0; j < 4; ++j) {
            double xb = transProbs[ctx][j];
            ctxTrans_[ctx][j] = xb;
            sum += xb;
        }
        for (size_t j = 0; j < 4; ++j)
            ctxTrans_[ctx][j] /= sum;

        // cached expectations
        for (size_t move = 0; move < 3; ++move)
            for (size_t moment = 0; moment < 2; ++moment)
                cachedEmissionExpectations_[ctx][move][moment] =
                    CalculateExpectedLLForEmission(move, ctx, moment);
    }
}

std::unique_ptr<AbstractRecursor> Kit__500_Chem__1_BC__1_PW3_v6_Model::CreateRecursor(const MappedRead& mr,
                                                                 double scoreDiff) const
{
    const double counterWeight = CounterWeight(
        [this](size_t ctx, MoveType m) { return ctxTrans_[ctx][static_cast<uint8_t>(m)]; },
        [](size_t ctx, MoveType m) {
            double r = 0.0;
            for (size_t o = 0; o < OUTCOME_NUMBER; ++o) {
                const double p = emissionPmf[static_cast<uint8_t>(m)][ctx][o];
                if (p > 0.0) r += p * std::log(p);
            }
            return r;
        },
        CONTEXT_NUMBER);

    return std::make_unique<Kit__500_Chem__1_BC__1_PW3_v6_Recursor>(mr, scoreDiff, counterWeight);
}

std::vector<TemplatePosition> Kit__500_Chem__1_BC__1_PW3_v6_Model::Populate(const std::string& tpl) const
{
    auto rowFetcher = [this](const NCBI2na prev, const NCBI2na curr) -> const double(&)[4]
    {
        const auto row = EncodeContext16(prev, curr);
        const double(&params)[4] = ctxTrans_[row];
        return params;
    };
    return AbstractPopulater(tpl, rowFetcher);
}

double Kit__500_Chem__1_BC__1_PW3_v6_Model::ExpectedLLForEmission(const MoveType move, const AlleleRep& prev,
                                             const AlleleRep& curr, const MomentType moment) const
{
    auto cachedEmissionVisitor = [this](const MoveType move, const NCBI2na prev, const NCBI2na curr,
                                        const MomentType moment) -> double {
        const auto row = EncodeContext16(prev, curr);
        return cachedEmissionExpectations_[row][static_cast<uint8_t>(move)]
                                          [static_cast<uint8_t>(moment)];
    };
    return AbstractExpectedLLForEmission(move, prev, curr, moment, cachedEmissionVisitor);
}

Kit__500_Chem__1_BC__1_PW3_v6_Recursor::Kit__500_Chem__1_BC__1_PW3_v6_Recursor(const MappedRead& mr, double scoreDiff, double counterWeight)
    : Recursor<Kit__500_Chem__1_BC__1_PW3_v6_Recursor>(mr, scoreDiff)
    , counterWeight_{counterWeight}
    , nLgCounterWeight_{-std::log(counterWeight_)}
{
}

std::vector<uint8_t> Kit__500_Chem__1_BC__1_PW3_v6_Recursor::EncodeRead(const MappedRead& read)
{
    std::vector<uint8_t> result;
    result.reserve(read.Length());
    std::vector<uint8_t> pw_boundaries = {18, 46};
    std::vector<uint8_t> cr_boundaries = {255};
    for (size_t i = 0; i < read.Length(); ++i) {
        result.emplace_back(EncodeBaseV3(read.Seq[i], read.PulseWidth[i], pw_boundaries, read.CR[i], cr_boundaries));
    }

    return result;
}

double Kit__500_Chem__1_BC__1_PW3_v6_Recursor::EmissionPr(const MoveType move, const uint8_t emission,
                                     const AlleleRep& prev, const AlleleRep& curr) const
{
    return AbstractEmissionPrV2(emissionPmf, move, emission, prev, curr) * counterWeight_;
}

double Kit__500_Chem__1_BC__1_PW3_v6_Recursor::UndoCounterWeights(const size_t nEmissions) const
{
    return nLgCounterWeight_ * nEmissions;
}

inline std::pair<Data::SNR, std::vector<TemplatePosition>> Kit__500_Chem__1_BC__1_PW3_v6_InitialiseModel(
    std::default_random_engine* const rng, const std::string& tpl)
{
    Data::SNR snrs{0, 0, 0, 0};
    for (uint8_t i = 0; i < 4; ++i) {
        snrs[i] = std::uniform_real_distribution<double>{snrRanges[0][i], snrRanges[1][i]}(*rng);
    }


    Data::NucleotideLevelFeats feats;

    const Kit__500_Chem__1_BC__1_PW3_v6_Model model{feats};
    std::vector<TemplatePosition> transModel = model.Populate(tpl);

    return {snrs, transModel};
}

BaseData Kit__500_Chem__1_BC__1_PW3_v6_GenerateReadData(std::default_random_engine* const rng, const MoveType state,
                                   const AlleleRep& prev, const AlleleRep& curr)
{
    // distribution is arbitrary at the moment, as
    // IPD is not a covariate of the consensus HMM
    std::uniform_int_distribution<uint8_t> ipdDistrib(1, 5);

    std::array<double, OUTCOME_NUMBER> emissionDist;
    for (size_t i = 0; i < OUTCOME_NUMBER; ++i) {
        emissionDist[i] = AbstractEmissionPrV2(emissionPmf, state, i, prev, curr);
    }

    std::discrete_distribution<uint8_t> outcomeDistrib(emissionDist.cbegin(), emissionDist.cend());

    const uint8_t event = outcomeDistrib(*rng);
    const std::pair<char, uint8_t> outcome = DecodeEmission(event);

    return {outcome.first, outcome.second, ipdDistrib(*rng)};
}

std::pair<Data::Read, std::vector<MoveType>> Kit__500_Chem__1_BC__1_PW3_v6_Model::SimulateRead(
    std::default_random_engine* const rng, const std::string& tpl,
    const std::string& readname) const
{
    return SimulateReadImpl(rng, tpl, readname, Kit__500_Chem__1_BC__1_PW3_v6_InitialiseModel,
                            Kit__500_Chem__1_BC__1_PW3_v6_GenerateReadData);
}

}  // namespace anonymous
}  // namespace S_P2C2v5

REGISTER_MODEL_IMPL(Kit__500_Chem__1_BC__1_PW3_v6)

}  // namespace Consensus
}  // namespace PacBio
