// Author: Lance Hepler

#include "../UnanimityInternalConfig.h"

#include <cassert>
#include <cmath>
#include <memory>
#include <random>
#include <stdexcept>

#include <pacbio/consensus/ModelConfig.h>
#include <pacbio/data/Read.h>
#include <pacbio/data/internal/BaseEncoding.h>

#include "../ModelFactory.h"
#include "../Recursor.h"
#include "../Simulator.h"
#include "CounterWeight.h"
#include "HelperFunctions.h"

using namespace PacBio::Data;

namespace PacBio {
namespace Consensus {
namespace Kit__500_Chem__1_BC__1_PW3_v5 {
namespace {

static constexpr const size_t CONTEXT_NUMBER = 16;
static constexpr const size_t OUTCOME_NUMBER = 64; // 4cr, 4pw, 4base

class Kit__500_Chem__1_BC__1_PW3_v5_Model : public ModelConfig
{
public:
    static std::set<std::string> Chemistries() { return {"Kit__500_Chem__1_BC__1_PW3_v5"}; }
    static ModelForm Form() { return ModelForm::PWSNR; }
    Kit__500_Chem__1_BC__1_PW3_v5_Model(const NucleotideLevelFeats& feats);
    std::unique_ptr<AbstractRecursor> CreateRecursor(const MappedRead& mr,
                                                     double scoreDiff) const override;
    std::vector<TemplatePosition> Populate(const std::string& tpl) const override;
    std::pair<Data::Read, std::vector<MoveType>> SimulateRead(
        std::default_random_engine* const rng, const std::string& tpl,
        const std::string& readname) const override;

    double ExpectedLLForEmission(MoveType move, const AlleleRep& prev, const AlleleRep& curr,
                                 MomentType moment) const override;

private:
    double ctxTrans_[CONTEXT_NUMBER][4];
    double cachedEmissionExpectations_[CONTEXT_NUMBER][3][2];
};

// TODO(lhepler) comments regarding the CRTP
class Kit__500_Chem__1_BC__1_PW3_v5_Recursor : public Recursor<Kit__500_Chem__1_BC__1_PW3_v5_Recursor>
{
public:
    Kit__500_Chem__1_BC__1_PW3_v5_Recursor(const MappedRead& mr, double scoreDiff, double counterWeight);
    static inline std::vector<uint8_t> EncodeRead(const MappedRead& read);
    inline double EmissionPr(MoveType move, uint8_t emission, const AlleleRep& prev,
                             const AlleleRep& curr) const;
    double UndoCounterWeights(size_t nEmissions) const override;

private:
    double counterWeight_;
    double nLgCounterWeight_;
};

static constexpr const double snrRanges[2][4] = {
    {3.91070819, 7.37540293, 3.84641552, 6.27542830},  // minimum
    {8.06702614, 15.2471046, 7.02776623, 11.3469543}   // maximum
};

static constexpr const double emissionPmf[3][CONTEXT_NUMBER][OUTCOME_NUMBER] = {

{ // match
 {0.018683563265015454,0.0006807495696211752,0.0004121159965451055,0.0005033870420323698,0.9292173988997241,0.004238742543971355,0.010092113586445996,0.006843438296793261,0.02828027412464035,0.000358126044918354,0.00041093366081531825,0.0002655530105142399,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534,0.00000026161459544177534},
{0.0004034238756033894,0.011500982284999696,0.00026883058965486564,0.00021332935827829164,0.01204833098105734,0.8733452820439506,0.0017965143826765345,0.0024092358176804707,0.001028244707041034,0.09671493947195937,0.0000881716016478234,0.0001558842238713764,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573,0.0000005159742611399573},
{0.0005176138969965385,0.00028739042474946845,0.025788666524305642,0.0009207019755159933,0.015262965684364926,0.003207484755687724,0.9339153460252536,0.0041488087061348974,0.0011350111684626752,0.0004954478909474141,0.014115608082518466,0.00018544947760658521,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181,0.000000375103604924181},
{0.00041444949135651066,0.00016345788055716496,0.00018392705277918157,0.026050214885976954,0.014043843422860037,0.002214996572777998,0.003967800887307868,0.9298345500688664,0.001480369189327046,0.0005562588729528954,0.0003570830988201294,0.020715190960698543,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891,0.0000003434156869085891},
{0.015398569158579853,0.0004594874350657259,0.0005881953338516854,0.0004002072174712468,0.9001489434305174,0.01025325253024892,0.009399574253915643,0.005096216379312945,0.054555911370492705,0.002708823150746136,0.0006438970487041818,0.00032710056360117987,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275,0.00000038119475946801275},
{0.0005317944416453201,0.007842985221861876,0.0003479236027963866,0.0002476033230124034,0.005969696122436512,0.7504306281303943,0.00167618734706425,0.0033206386107340106,0.0002929174097517295,0.22901787351543218,0.00006717697348101257,0.00022926792533085102,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277,0.0000004866803088313277},
{0.0011995759530171908,0.00024562778321930256,0.02160369187828013,0.0005030141004001167,0.004045141171702976,0.009728074883458658,0.9208931727600113,0.0031649635324480854,0.00014386509221647384,0.0026226782118269985,0.03557639203290143,0.00012064484165558605,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786,0.000002945341516572786},
{0.0003095781113813932,0.00012848659342358485,0.00017803991462643544,0.01859342485037077,0.003471887629208509,0.0061970470603827455,0.0033912171577303294,0.908960352971278,0.0003083816297736165,0.0020583107612476173,0.00034303645403347755,0.05604094360061812,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364,0.0000003710243447192364},
{0.01547929439416785,0.0005825466960853362,0.0005693046440590891,0.0004331226237201045,0.8946806091173897,0.0028984126316073592,0.016998926136380342,0.004864269734748552,0.0616773131824285,0.0002713316821574444,0.0011617391200226695,0.0003591678885975276,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756,0.0000004608105506840756},
{0.000203541902648159,0.006211931704216744,0.00022596665449847646,0.000315091033569825,0.0027660280795125283,0.7011900106307191,0.004894470409518899,0.002694854899508143,0.00025164446755537325,0.2807130246662962,0.00035034756845689764,0.00015123172864747137,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584,0.000000612620285618584},
{0.0005825212223649264,0.00028813252296458887,0.018318470881109626,0.0010320683992162678,0.00578238846872466,0.0038346877481937763,0.9120736513748483,0.0050166733729318244,0.0003404541534950389,0.0009023587750632246,0.05156967750800314,0.0002335121641674927,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659,0.0000004885270945590659},
{0.00023644430731042156,0.00009968457620817749,0.0001752942185746907,0.015517971066566957,0.0040138131828022046,0.002103627911734847,0.0070623062409172505,0.8895213730869959,0.00048445787900611165,0.0007852628067247002,0.0008084418725113034,0.0791641306202703,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525,0.0000005229275072528525},
{0.006931208987108882,0.00024532081857780487,0.00022182221496098713,0.0003469424495094653,0.7942950108679683,0.001770019291071711,0.007445927822256856,0.011232060813248151,0.17389548147809278,0.0002294270548473168,0.0019890923835853493,0.0013762426636830462,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654,0.0000004123683671023654},
{0.00014123133789122226,0.0039002194528258622,0.0001100375813536966,0.00014536130029729475,0.0018541090010912096,0.6205975156707745,0.0007400825749699619,0.00470243204523908,0.00014937421923436923,0.3670289497556766,0.0000711824937454729,0.000537072350042478,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071,0.0000004313887857355071},
{0.00021034264579618514,0.00009689105647426278,0.008613165440450744,0.0003733016601179896,0.002027292954873739,0.0018376263941935463,0.8512194986764594,0.005888074277667131,0.00017644622690901626,0.0005677608024840361,0.12845209188282547,0.0005186635280856397,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866,0.0000003623933396688866},
{0.000192092624207954,0.00008671447622535011,0.00010086479000181123,0.01098744877237992,0.004279958363195141,0.002285724795304413,0.0031573708315815957,0.8584601209637942,0.0007799489417365805,0.0010021547870640401,0.0006209421920973289,0.11803314859836207,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473,0.00000025980507787695473} 
},
{ // branch
 {0.026551275247649758,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.9255193779058156,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.04560808668161862,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119,0.00003805344532649119},
{0.00001711521351427873,0.03321227083856851,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.8647728306997575,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.10097087043730299,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873,0.00001711521351427873},
{0.00002309334041767797,0.00002309334041767797,0.049852614363055235,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.9072809542955941,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.041457737575872365,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797,0.00002309334041767797},
{0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.03988216729416656,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.9016811146193212,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.057655462346729816,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325,0.00001280747114397325},
{0.03063080564647549,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.9019277660832434,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.06716864246579232,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762,0.000004471898434242762},
{0.00016180336751690783,0.026177025426960203,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.7914630536434606,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.17248991551104778,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783,0.00016180336751690783},
{0.0001266998901934285,0.0001266998901934285,0.046044115133859906,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.8973613029070259,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0488658886573151,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285,0.0001266998901934285},
{0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.030053268306750782,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.882091932171483,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.08715868010663393,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505,0.000011411793690693505},
{0.027891777327651836,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.8938270948445989,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.07785414725702017,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777,0.000006999681487361777},
{0.000021093124181108508,0.02559429877380273,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.755365052486724,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.21775396816442563,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508,0.000021093124181108508},
{0.00015433261909632867,0.00015433261909632867,0.03681132059670494,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.8967060155026517,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.05706837413576724,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867,0.00015433261909632867},
{0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.02504981822830492,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.876403688230264,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.09747518210184253,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435,0.000017562482616205435},
{0.019518027508523227,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.8213094789464384,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.15893315278602801,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632,0.000003923619000170632},
{0.00000791118426196838,0.016731480116955515,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.6657835577257958,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.31700237991726865,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838,0.00000791118426196838},
{0.00001193109708194962,0.00001193109708194962,0.02812067093090859,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.8512266185180616,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.11992491362903093,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962,0.00001193109708194962},
{0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.022403750169115954,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.8675038972847596,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.1052967725972432,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586,0.0000786160647357586} 
},
{ // stick
 {0.000011461544120547724,0.0951467202036281,0.03790412604926438,0.02136325205055021,0.000011461544120547724,0.3278415655651856,0.29097821880141034,0.19539036242291,0.000011461544120547724,0.011940085799875398,0.01091627670761903,0.007889007472926767,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724,0.000011461544120547724},
{0.010528444598189012,0.00003009060069936154,0.03328067089443494,0.05430023841552694,0.3110460729083592,0.00003009060069936154,0.24667737954254357,0.29763546193620655,0.023695065118159258,0.00003009060069936154,0.011857329498842212,0.009324354049273476,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154,0.00003009060069936154},
{0.0068429889430571345,0.02082725245523882,0.000015019065481146241,0.16370257453560524,0.18845900080369465,0.13798877016324093,0.000015019065481146241,0.4487139081087003,0.013814629571049668,0.012013855262546653,0.000015019065481146241,0.006810971555403528,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241,0.000015019065481146241},
{0.012206730684417577,0.02452142516920797,0.022762485519561088,0.00003034276742503984,0.3973921685082061,0.18081725539083954,0.27555255002734375,0.00003034276742503984,0.035616999006215566,0.021922061426462892,0.02753947205936833,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984,0.00003034276742503984},
{0.000018034459238137766,0.015035845934270967,0.12109006982131765,0.02301252919590218,0.000018034459238137766,0.2564786697782866,0.346403516411987,0.15378962006427258,0.000018034459238137766,0.06802136677993892,0.008245382724078506,0.006931104031848016,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766,0.000018034459238137766},
{0.07675791984707732,0.00003769303435647033,0.0626829317466806,0.052807356745285375,0.31293925899000785,0.00003769303435647033,0.24368166859173856,0.22261535310337854,0.010962829116437289,0.00003769303435647033,0.005886541629034506,0.009593023340754089,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033,0.00003769303435647033},
{0.23259296799368628,0.004385393736182872,0.00010120139391191243,0.055248116006608686,0.4213547493265008,0.10661213820501676,0.00010120139391191243,0.1426194372574893,0.004440309221251351,0.023291226231401303,0.00010120139391191243,0.0038895853567074558,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243,0.00010120139391191243},
{0.12048163942127657,0.007150095373155697,0.049366924039259526,0.00002572263659816735,0.32913948009965227,0.1948015149635955,0.21927889679001436,0.00002572263659816735,0.012217853583562078,0.05106960306183124,0.015079247654753563,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735,0.00002572263659816735},
{0.000024609533504353692,0.13925447612121702,0.014116333652621363,0.03542933429685698,0.000024609533504353692,0.39122233263657197,0.20986418780622415,0.17470613069264773,0.000024609533504353692,0.012015557040606303,0.014599367286985887,0.007438756123529175,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692,0.000024609533504353692},
{0.03463669977550086,0.000028084163666668408,0.008661460864173664,0.08508565452211639,0.2010075030435396,0.000028084163666668408,0.11575530289967902,0.5340630426339376,0.005880693247783311,0.000028084163666668408,0.006899342874111539,0.006465671137491357,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408,0.000028084163666668408},
{0.07815747121807039,0.015163581135107443,0.000020867313488679967,0.16894597581947476,0.2470063897655048,0.11315098536586628,0.000020867313488679967,0.3482914765759553,0.008954180394204581,0.013630561523229768,0.000020867313488679967,0.005551675960709275,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967,0.000020867313488679967},
{0.10282123927944449,0.04304645480873523,0.0064005350493676685,0.0000450766512730485,0.3974813683174738,0.2304178640516152,0.1560934547304626,0.0000450766512730485,0.018171481365522022,0.02718960707137346,0.015898779505987858,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485,0.0000450766512730485},
{0.000022349504672605744,0.05395309029546392,0.049404359712678925,0.011452821754903897,0.000022349504672605744,0.20190941000772702,0.29261825313499445,0.32522687346022305,0.000022349504672605744,0.014023534548176177,0.020906315727467713,0.029276118601371463,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744,0.000022349504672605744},
{0.03592755398123932,0.000038151898382270785,0.05273657060570723,0.01180401990878443,0.26308750596308256,0.000038151898382270785,0.29443831089420064,0.2876576242724152,0.013092311919274131,0.000038151898382270785,0.010457169170545197,0.028700578873726384,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785,0.000038151898382270785},
{0.09624453630005225,0.020596888588882582,0.000033008654408600056,0.01635898677248542,0.3545236953521256,0.21008882654489458,0.000033008654408600056,0.2360303024565092,0.01583340711236709,0.0312011107284268,0.000033008654408600056,0.017306770151783515,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056,0.000033008654408600056},
{0.05981881407979891,0.019933883773800124,0.017151630895831865,0.00002432962454297083,0.4021117359696336,0.17829352390659084,0.2182614389784726,0.00002432962454297083,0.037625292851352785,0.03619191962246458,0.029273630572191275,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083,0.00002432962454297083} 
}
};

static constexpr const double transProbs[CONTEXT_NUMBER][4] = {
{0.9532757260133431,0.006606343444141254,0.021971124832282165,0.018146805710233527}, // AA
{0.9221159067348833,0.028158332548144416,0.01600284514838728,0.03372291556858497}, // AC
{0.9041770912794622,0.014825008528518879,0.022806754931943243,0.05819114526007565}, // AG
{0.9109046031903868,0.024657046093820946,0.010395878137485444,0.05404247257830681}, // AT
{0.8323594527563976,0.07108845431729877,0.01761207949873657,0.07894001342756714}, // CA
{0.975311199382568,0.002910620752602607,0.012594585730716142,0.009183594134113198}, // CC
{0.8849358363996876,0.020450646552754106,0.02564547341791387,0.0689680436296444}, // CG
{0.913496317143274,0.029718832474816218,0.013172612985713173,0.04361223739619663}, // CT
{0.8470705391647106,0.05586189274879787,0.015870864540761115,0.08119670354573039}, // GA
{0.9200751312041687,0.026740357878564065,0.020074836107037666,0.033109674810229556}, // GC
{0.9627087142676465,0.0030247269484589673,0.02256357688952785,0.01170298189436673}, // GG
{0.9242130047659968,0.027546897251193272,0.010713729156634367,0.03752636882617554}, // GT
{0.8319797475328506,0.08762458268059642,0.01536499111618097,0.06503067867037192}, // TA
{0.9138807071615825,0.049941340630071766,0.010335792135423044,0.025842160072922605}, // TC
{0.9227913706075156,0.02806432279091914,0.010130256324310884,0.03901405027725434}, // TG
{0.9801403106933549,0.003229099906345165,0.01047059225568476,0.006159997144615159}, // TT
    };

inline double CalculateExpectedLLForEmission(const size_t move, const uint8_t row,
                                             const size_t moment)
{
    double expectedLL = 0;
    for (size_t i = 0; i < OUTCOME_NUMBER; i++) {
        double curProb = emissionPmf[move][row][i];
        double lgCurProb = std::log(curProb);
        if (!std::isfinite(lgCurProb)) continue;
        if (moment == static_cast<uint8_t>(MomentType::FIRST))
            expectedLL += curProb * lgCurProb;
        else if (moment == static_cast<uint8_t>(MomentType::SECOND))
            expectedLL += curProb * (lgCurProb * lgCurProb);
    }
    return expectedLL;
}

Kit__500_Chem__1_BC__1_PW3_v5_Model::Kit__500_Chem__1_BC__1_PW3_v5_Model(const NucleotideLevelFeats& feats){
    for (size_t ctx = 0; ctx < CONTEXT_NUMBER; ++ctx) {
        const uint8_t bp = ctx & 3;  // (equivalent to % 4)
        double sum = 0.0;

        // cached transitions
        for (size_t j = 0; j < 4; ++j) {
            double xb = transProbs[ctx][j];
            ctxTrans_[ctx][j] = xb;
            sum += xb;
        }
        for (size_t j = 0; j < 4; ++j)
            ctxTrans_[ctx][j] /= sum;

        // cached expectations
        for (size_t move = 0; move < 3; ++move)
            for (size_t moment = 0; moment < 2; ++moment)
                cachedEmissionExpectations_[ctx][move][moment] =
                    CalculateExpectedLLForEmission(move, ctx, moment);
    }
}

std::unique_ptr<AbstractRecursor> Kit__500_Chem__1_BC__1_PW3_v5_Model::CreateRecursor(const MappedRead& mr,
                                                                 double scoreDiff) const
{
    const double counterWeight = CounterWeight(
        [this](size_t ctx, MoveType m) { return ctxTrans_[ctx][static_cast<uint8_t>(m)]; },
        [](size_t ctx, MoveType m) {
            double r = 0.0;
            for (size_t o = 0; o < OUTCOME_NUMBER; ++o) {
                const double p = emissionPmf[static_cast<uint8_t>(m)][ctx][o];
                if (p > 0.0) r += p * std::log(p);
            }
            return r;
        },
        CONTEXT_NUMBER);

    return std::make_unique<Kit__500_Chem__1_BC__1_PW3_v5_Recursor>(mr, scoreDiff, counterWeight);
}

std::vector<TemplatePosition> Kit__500_Chem__1_BC__1_PW3_v5_Model::Populate(const std::string& tpl) const
{
    auto rowFetcher = [this](const NCBI2na prev, const NCBI2na curr) -> const double(&)[4]
    {
        const auto row = EncodeContext16(prev, curr);
        const double(&params)[4] = ctxTrans_[row];
        return params;
    };
    return AbstractPopulater(tpl, rowFetcher);
}

double Kit__500_Chem__1_BC__1_PW3_v5_Model::ExpectedLLForEmission(const MoveType move, const AlleleRep& prev,
                                             const AlleleRep& curr, const MomentType moment) const
{
    auto cachedEmissionVisitor = [this](const MoveType move, const NCBI2na prev, const NCBI2na curr,
                                        const MomentType moment) -> double {
        const auto row = EncodeContext16(prev, curr);
        return cachedEmissionExpectations_[row][static_cast<uint8_t>(move)]
                                          [static_cast<uint8_t>(moment)];
    };
    return AbstractExpectedLLForEmission(move, prev, curr, moment, cachedEmissionVisitor);
}

Kit__500_Chem__1_BC__1_PW3_v5_Recursor::Kit__500_Chem__1_BC__1_PW3_v5_Recursor(const MappedRead& mr, double scoreDiff, double counterWeight)
    : Recursor<Kit__500_Chem__1_BC__1_PW3_v5_Recursor>(mr, scoreDiff)
    , counterWeight_{counterWeight}
    , nLgCounterWeight_{-std::log(counterWeight_)}
{
}

std::vector<uint8_t> Kit__500_Chem__1_BC__1_PW3_v5_Recursor::EncodeRead(const MappedRead& read)
{
    std::vector<uint8_t> result;
    result.reserve(read.Length());
    std::vector<uint8_t> pw_boundaries = {4, 100};
    std::vector<uint8_t> cr_boundaries = {255};
    for (size_t i = 0; i < read.Length(); ++i) {
        result.emplace_back(EncodeBaseV3(read.Seq[i], read.PulseWidth[i], pw_boundaries, read.CR[i], cr_boundaries));
    }

    return result;
}

double Kit__500_Chem__1_BC__1_PW3_v5_Recursor::EmissionPr(const MoveType move, const uint8_t emission,
                                     const AlleleRep& prev, const AlleleRep& curr) const
{
    return AbstractEmissionPrV2(emissionPmf, move, emission, prev, curr) * counterWeight_;
}

double Kit__500_Chem__1_BC__1_PW3_v5_Recursor::UndoCounterWeights(const size_t nEmissions) const
{
    return nLgCounterWeight_ * nEmissions;
}

inline std::pair<Data::SNR, std::vector<TemplatePosition>> Kit__500_Chem__1_BC__1_PW3_v5_InitialiseModel(
    std::default_random_engine* const rng, const std::string& tpl)
{
    Data::SNR snrs{0, 0, 0, 0};
    for (uint8_t i = 0; i < 4; ++i) {
        snrs[i] = std::uniform_real_distribution<double>{snrRanges[0][i], snrRanges[1][i]}(*rng);
    }


    Data::NucleotideLevelFeats feats;

    const Kit__500_Chem__1_BC__1_PW3_v5_Model model{feats};
    std::vector<TemplatePosition> transModel = model.Populate(tpl);

    return {snrs, transModel};
}

BaseData Kit__500_Chem__1_BC__1_PW3_v5_GenerateReadData(std::default_random_engine* const rng, const MoveType state,
                                   const AlleleRep& prev, const AlleleRep& curr)
{
    // distribution is arbitrary at the moment, as
    // IPD is not a covariate of the consensus HMM
    std::uniform_int_distribution<uint8_t> ipdDistrib(1, 5);

    std::array<double, OUTCOME_NUMBER> emissionDist;
    for (size_t i = 0; i < OUTCOME_NUMBER; ++i) {
        emissionDist[i] = AbstractEmissionPrV2(emissionPmf, state, i, prev, curr);
    }

    std::discrete_distribution<uint8_t> outcomeDistrib(emissionDist.cbegin(), emissionDist.cend());

    const uint8_t event = outcomeDistrib(*rng);
    const std::pair<char, uint8_t> outcome = DecodeEmission(event);

    return {outcome.first, outcome.second, ipdDistrib(*rng)};
}

std::pair<Data::Read, std::vector<MoveType>> Kit__500_Chem__1_BC__1_PW3_v5_Model::SimulateRead(
    std::default_random_engine* const rng, const std::string& tpl,
    const std::string& readname) const
{
    return SimulateReadImpl(rng, tpl, readname, Kit__500_Chem__1_BC__1_PW3_v5_InitialiseModel,
                            Kit__500_Chem__1_BC__1_PW3_v5_GenerateReadData);
}

}  // namespace anonymous
}  // namespace S_P2C2v5

REGISTER_MODEL_IMPL(Kit__500_Chem__1_BC__1_PW3_v5)

}  // namespace Consensus
}  // namespace PacBio
